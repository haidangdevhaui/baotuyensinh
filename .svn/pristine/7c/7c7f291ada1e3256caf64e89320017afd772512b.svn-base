app.controller('mediaCtrl', ['$scope', '$rootScope', 'Api', '$state', 'toaster', '$compile', function($scope, $rootScope, Api, $state, toaster, $compile){
	$scope.record = 10;
	
	$scope.getMedia = function(){

	}
	$scope.createCateMedia = function(data){
		Api.post('media/category/create', data).then(function(response){
			if(response.data.error){
				return toaster.pop('warning', '', response.data.error);
			}
			toaster.pop('success', '', 'Thêm danh mục media thành công!');
			$scope.getCateMedia();
			$scope.cate = {};
		});
	}
	$scope.getCateMedia = function(media){
		if(media){
			uri = 'media/category?media=' + media;
		}else{
			uri = 'media/category';
		}
		Api.get(uri).then(function(response){
			$scope.datas = response.data.data;
		});
	}
	switch($state.current.name){
		case 'media':

			break;
		case 'media-category':
			$scope.getCateMedia();
			break;
		case 'media-create': 
			$scope.data = {};
			break;
	}
	$scope.deleteCateMedia = function(id){
		Api.get('media/category/delete/' + id).then(function(response){
			$('#data-' + id).fadeOut();
		});
	}
	$scope.img = [];
	var i = 0;
	$scope.addFileImg = function(){
		i++;
		$('#fileImgDiv').append($compile('<input type="file" file-model="img[' + i + ']">')($scope));
	}
	$scope.uploadImg = function(img){
		Api.upload('upload', img).success(function(response){
			$scope.img = [];
			$scope.data.images = response.data;
		});
	}
	$scope.createMedia = function(data){
		if(!data.img){
			if(!data.first_frame){
				return toaster.pop('warning', '', 'Hãy chọn ảnh cho media hoặc chọn hình đại diện của media!'); 
			}
		}
		Api.post('media/create', data).then(function(response){
			if(response.data.error){
				return toaster.pop('warning', '', response.data.error);
			}
			if(data.img){
				Api.upload('media/upload/' + response.data.data[0]._id, data.img);
			}
			toaster.pop('success', '', 'Thêm video thành công!');
			$scope.data = {};
		});
	}
	$scope.selectMedia = function(media){
		$scope.getCateMedia(media);
	}
	$scope.options = {
        language: 'en',
        allowedContent: true,
        entities: false,
        extraPlugins : 'syntaxhighlight'
    };
    $scope.onReady = function() {
        
    };
    
}])
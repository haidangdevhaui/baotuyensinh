app.controller('mediaCtrl', ['$scope', '$rootScope', 'Api', '$state', 'toaster', function($scope, $rootScope, Api, $state, toaster){
	$scope.Video = new $rootScope.Model("videos");
	$scope.record = 10;
	switch($state.current.name){
		case "videos":
			$scope.Video.getList();
			break;
	}
	$scope.createCateMedia = function(data){
		Api.post('media/category/create', data).then(function(response){
			if(response.data.error){
				return toaster.pop('warning', '', response.data.error);
			}
			toaster.pop('success', '', 'Thêm danh mục media thành công!');
			$scope.getCateMedia();
			$scope.cate = {};
		});
	}
	$scope.getCateMedia = function(media){
		Api.get('media/category?media=' + media).then(function(response){
			$scope.datas = response.data.data;
		});
	}
	$scope.deleteCateMedia = function(id){
		Api.get('media/category/delete/' + id).then(function(response){
			$('#data-' + id).fadeOut();
		});
	}
	$scope.createMedia = function(data){
		if(!data.img){
			if(!data.first_frame){
				return toaster.pop('warning', '', 'Hãy chọn ảnh cho media hoặc chọn hình đại diện của media!'); 
			}
		}
		Api.post('media/create', data).then(function(response){
			if(response.data.error){
				return toaster.pop('warning', '', response.data.error);
			}
			if(data.img){
				Api.upload('media/upload/' + response.data.data[0]._id, data.img);
			}
			toaster.pop('success', '', 'Thêm video thành công!');
			$scope.data = {};
		});
	}
	$scope.selectMedia = function(media){
		$scope.getCateMedia(media);
	}
	$scope.options = {
        language: 'en',
        allowedContent: true,
        entities: false,
        extraPlugins : 'syntaxhighlight'
    };
    $scope.onReady = function() {
        
    };
}])
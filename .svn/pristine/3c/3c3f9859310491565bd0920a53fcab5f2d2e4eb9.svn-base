;( function( window ) {	
	'use strict';
	/**
	 * This witen by emgathatday
	 * Website url: onegovn.com
	 */
	$.fn.resbtn = function(){		
		this.each(function(){
			var elem = $(this),
				target = $(elem.attr('href'));
			if(elem.attr('href') == null){
				target = $(elem.data('href'));
			}			
			elem.click(function(e){				
				e.stopPropagation();
				
				if($(this).hasClass('open')){
					$(this).removeClass('open');
					target.removeClass('open');
					if($(this).data('body') == true){
						$('body').removeClass('open-menu');						
					}
				}else{
					$('body').click();
					$(this).addClass('open');
					target.addClass('open');
					if($(this).data('body') == true){
						$('body').addClass('open-menu');						
					}
				}
				
				return false;
			});
			target.click(function(e){
				e.stopPropagation();
			});
			$('body').click(function() {
				$('body').removeClass('open-menu');
				elem.removeClass('open');
				target.removeClass('open');
			});

			$('.form-vote').on('submit', function(e){
				e.preventDefault();
				$.ajax({
					url: '/make-vote',
					type: 'post',
					data: {
						score: $(this).find('input[name="rate"]:checked').val()
					},
					success: function(res){
						bindHtmlRate(res);
					}
				});
			});

			$('#xemkq').click(function(){
				$.ajax({
					url: '/make-vote',
					type: 'get',
					success: function(res){
						bindHtmlRate(res);
					}
				});
			});
			function bindHtmlRate(res){
				var html = '';
				html += '<p>Tổng số phiếu: ' + res.total + ' phiếu</p>';
				html += '<p>Tuyệt vời: ' + res.score[3] + '</p>';
				html += '<p>Chuyên nghiệp: ' + res.score[2] + '</p>';
				html += '<p>Bình thường: ' + res.score[1] + '</p>';
				html += '<p>Kém: ' + res.score[0] + '</p>';
				return $('.rate-form').html(html);
			}
		});
	};
})( window );	


$('.rate-form');